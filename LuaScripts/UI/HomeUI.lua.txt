---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Saukiya.
--- DateTime: 2020/8/14 1:36
---
---主界面

---@type UI.RuaUI
self = self

local clip = Asset.Load("Audio/Music/Home", "m_sys_void_intro")
local loop_clip = Asset.Load("Audio/Music/Home", "m_sys_void_loop")

local target = Vector2.zero
local current = Vector2.zero
local CanvasSizeExceptTwo = UIManager:GetCanvasSize() / 2;

---@type Data.Player.PlayerData
local data;

function update()---刷新时间 - 跟随鼠标
    time.text = DateTime.Now:ToString("yyyy/MM/dd/ HH:mm")
    if screenHasMouse() then
        target = Input.mousePosition;
        --- 这里遇到Vector3不能转Vector2的坑 自定义运算符倒是能支持
        target = (Vector2(target.x, target.y) - CanvasSizeExceptTwo) / CanvasSizeExceptTwo
    end
    current = Vector2.Lerp(current, target, 1.5 * Time.deltaTime)
    local rotationLocalPosition = move1.localPosition
    rotationLocalPosition.x = current.x * 50
    rotationLocalPosition.y = current.y * -30
    move1.localPosition = rotationLocalPosition

    local euler = move2.localRotation.eulerAngles
    rotationLocalPosition = move2.localPosition
    euler.y = current.x * -3
    euler.x = current.y * 4
    rotationLocalPosition.y = -current.y * 30
    move2.localPosition = rotationLocalPosition
    move2.rotation = Quaternion.Euler(euler)
end

function show()
    self:BaseShow()
    SoundManager:PlayMusic(clip, false, function ()
        SoundManager:PlayMusic(loop_clip, true);
    end)
    self.canvasGroup.alpha = 0
    self.canvasGroup:DOFade(1, 0.5)
    
    data = PlayerManager:Get()
end

function hide(destroy)
    self.canvasGroup:DOFade(0, 0.5):OnComplete(function()
        self:BaseHide(destroy)
    end)
end

function updateView()
    playerName.text = data:GetName()
    playerLevel.text = tostring(data:GetLevel() + 1)
    expPercentage.fillAmount = data:GetExp() / data:GetMaxExp()
    reason.text = tostring(data:GetReason())
    maxReason.text = tostring(data:GetMaxReason())
    sourceStone.text = "0"
    syntheticJade.text = "0"
    dragonCoin.text = "0"

    sourceStone.text = tostring(data:GetItemAmount(0));
    syntheticJade.text = tostring(data:GetItemAmount(1));
    dragonCoin.text = tostring(data:GetItemAmount(2));
    item = data:GetItemStack(1)
end

function screenHasMouse()
    local vector3 = Input.mousePosition
    return vector3.x <= Screen.width and vector3.x > 0 and vector3.y <= Screen.height and vector3.y > 0
end